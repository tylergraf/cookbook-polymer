<link rel="import" href="../polymer/polymer.html"><link rel="import" href="../vaadin-upload/vaadin-upload.html"><script src="../mock-http-request/lib/mock.js"></script><script src="../firebase/firebase.js"></script><dom-module id="firebase-upload"><style>:host{display:block}</style><template><vaadin-upload accept="[[accept]]" max-files="[[maxFiles]]" max-file-size="[[maxFileSize]]"></vaadin-upload></template></dom-module><script>Polymer({is:"firebase-upload",properties:{accept:{type:String,value:""},maxFiles:{type:Number,value:1/0},maxFileSize:{type:Number,value:1/0},url:{type:String,value:""}},ready:function(){},attached:function(){Object.getPrototypeOf(document.createElement("vaadin-upload"))._createXhr=this._uploadFile},detached:function(){},_uploadFile:function(e){var t=new MockHttpRequest;t.upload={};var a=!1;t.onsend=function(){function n(){setTimeout(o,200)}function o(){t.upload.onprogress({total:i,loaded:r}),a?e.abort||(r<i?(r=i,setTimeout(o,200)):setTimeout(u,200)):(setTimeout(o,200),r=Math.min(i,r+1016e3))}function u(){t.receive(200,'{"message":"OK"}')}var i=e&&e.size||1024,r=0;n()};var n=new FileReader,o=this.parentNode;return n.onload=function(e){return function(t){var n=t.target.result;new Firebase(o.url).push({file:n,name:e.name},function(e){a=!0})}}(e),n.readAsDataURL(e),t}})</script>