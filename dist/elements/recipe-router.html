<link rel="import" href="/components/polymer/polymer.html"><link rel="import" href="/components/app-route/app-route.html"><link rel="import" href="/components/iron-pages/iron-pages.html"><link rel="import" href="/elements/recipe-form-page.html"><dom-module id="recipe-router"><template><app-route route="{{route}}" pattern="/:recipeId" data="{{routeData}}"></app-route><iron-pages selected="[[page]]" attr-for-selected="name" fallback-selection="recipe"><recipe-page name="recipe" recipe-id="[[routeData.recipeId]]"></recipe-page><recipe-form-page name="form" route="[[route]]"></recipe-form-page></iron-pages></template><script>Polymer({
      is: 'recipe-router',
      properties: {
        route: Object,
        page: String
      },
      observers: ['_viewChanged(routeData.recipeId)','_pageChanged(page)'],
      _viewChanged: function(recipeId){
        if(!recipeId) return;
        var component;

        if(recipeId === 'add' || recipeId === 'edit') {
          this.page = 'form';
          component = 'recipe-form-page';
        } else {
          this.page = 'recipe';
          component = 'recipe-page';
        }
        var resolvedPageUrl = this.resolveUrl( `${component}.html`);
        this.importHref(resolvedPageUrl, null, null, true);
      },
      _pageChanged: function(page) {
        console.log(page);
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl( `${page}-page.html`);
        if(page === 'recipe'){
          resolvedPageUrl = this.resolveUrl('recipe-router.html')
        }
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },
    });</script></dom-module>