"use strict";var _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e};!function(){function e(){return function(e){var r="CATEGORIES";if(h.getCategories)return!1;var o={type:"RECEIVE_CATEGORIES"};I.exists(r)&&(o.categories=I.get(r),e(o)),fb.database().ref("categories").orderByChild("name").on("value",function(t){h.getCategories=!0;var a=[];t.forEach(function(e){var r=e.val();r.id=e.key,a.push(r)}),I.set(r,a),o.categories=a,e(o)})}}function r(){return function(e){return!h.getIcons&&void fb.database().ref("icons").orderByChild("name").on("value",function(r){h.getIcons=!0;var o=[];r.forEach(function(e){var r=e.val();r.id=e.key,o.push(r)});var t={type:"RECEIVE_ICONS",icons:o};e(t)})}}function o(e){return function(r){var o="CATEGORY_"+e,t={type:"RECEIVE_CATEGORY"};return e?!h.getCategory[e]&&(I.exists(o)&&(t.category=I.get(o),t.subcategories=t.category.subcategories,r(t)),h.getCategory.forEach(function(e){fb.database().ref("categories").child(e).off()}),h.getCategory=[],void fb.database().ref("categories").child(e).on("value",function(a){h.getCategory.push(e);var i=a.val();i.id=a.key,t.category=i,t.subcategories=i.subcategories,I.set(o,i),r(t)})):void console.error("No id passed")}}function t(e,r){return function(o){return e?r?!h.getFavorite[r+"_"+e]&&(h.getFavorite[r+"_"+e]=!0,void fb.database().ref("users/"+r+"/favorites").child(e).on("value",function(e){var r=e.val();if(r){var t={type:"RECEIVE_FAVORITE",recipeId:r};o(t)}})):void console.error("No userId passed"):void console.error("No recipeId passed")}}function a(e){return function(r){return e?!h.getFavorites&&(h.getFavorites=!0,void fb.database().ref("users/"+e).child("favorites").on("value",function(e){h.getFavorites=!1;var o=[];e.forEach(function(e){var r=e.val();r.id=e.key,o.push(r)});var t={type:"RECEIVE_FAVORITES",favorites:o};r(t)})):void console.error("No userId passed")}}function i(e){return function(r){var o="SUBCATEGORY"+e,t={type:"RECEIVE_SUBCATEGORY"};return e?!h.getSubcategory[e]&&(I.exists(o)&&(t.subcategory=I.get(o),t.recipes=t.subcategory.recipes,r(t)),h.getSubcategory.forEach(function(e){fb.database().ref("subcategories").child(e).off()}),h.getSubcategory=[],void fb.database().ref("subcategories").child(e).on("value",function(a){h.getSubcategory.push(e);var i=a.val();i.id=a.key,I.set(o,i),t.subcategory=i,t.recipes=i.recipes,r(t)})):void console.error("No id passed")}}function s(e){return function(r){var o="RECIPE_"+e;if(!e)return void console.error("No id passed");if(h.getRecipe[e])return!1;var t={type:"RECEIVE_RECIPE"};I.exists(o)&&(t.recipe=I.get(o),r(t)),h.getRecipe.forEach(function(e){fb.database().ref("recipes").child(e).off()}),h.getRecipe=[],fb.database().ref("recipes").child(e).on("value",function(a){h.getRecipe.push(e);var i=a.val();i.id=a.key,I.set(o,i),t.recipe=i,r(t)})}}function n(e,r){return function(o){if(!e)return void console.error("No name passed");if(!r)return void console.error("No categoryId passed");var t={name:e,categoryId:r},a=fb.database().ref().child("subcategories").push().key,i={};return i["/subcategories/"+a]=t,i["/categories/"+r+"/subcategories/"+a]={name:e},fb.database().ref().update(i)}}function c(e,r){return function(o){if(!e)return void console.error("No recipe passed");if(!e.id)return void console.error("Recipe doesn't have ID");if(!r)return void console.error("No Userid passed");if(e.userId!==r)return void console.error("User can't edit this recipe.");var t={};return t["/recipes/"+e.id]=e,t["/subcategories/"+e.subcategoryId+"/recipes/"+e.id]=e,t["/users/"+r+"/recipes/"+e.id]=e,fb.database().ref().update(t).then(function(r){o({type:"RECEIVE_RECIPE",recipe:e}),o({type:"RECIPE_SAVED",recipe:e})})}}function d(e,r,o){return function(t){if(!e)return void console.error("No recipeId passed");if(!o)return void console.error("No userId passed");var a=fb.database().ref().child("recipes").push().key,i={};i["users/"+o+"/favorites/"+a]=e,i["recipes/"+e+"/favorites/"+a]=o,i["/subcategories/"+r+"/recipes/"+e+"/favorites/"+a]=o,fb.database().ref().update(i).then(function(r){t({type:"FAVORITE_RECIPE",recipeId:e})})}}function u(e,r,o,t){return function(a){if(!t)return void console.error("No id passed");if(!e)return void console.error("No recipeId passed");if(!r)return void console.error("No subcategoryId passed");if(!o)return void console.error("No userId passed");a({type:"UNFAVORITE_RECIPE",recipeId:e});var i={type:"RECEIVE_FAVORITE",recipeId:e,remove:!0};a(i),fb.database().ref("users/"+o+"/favorites").child(t).remove(),fb.database().ref("recipes/"+e+"/favorites").child(t).remove(),fb.database().ref("/subcategories/"+r+"/recipes/"+e+"/favorites").child(t).remove()}}function f(e,r,o){return function(t){if(!e)return void console.error("No newRecipe passed");if(!r)return void console.error("No subcategoryId passed");if(!o)return void console.error("No userId passed");var a=_extends({subcategoryId:r,userId:o,imageUrl:"",icon:{},color:"",directions:[],ingredients:[],favorites:0,created:(new Date).getTime()},e),i=fb.database().ref().child("recipes").push().key,s={};s["/recipes/"+i]=a,s["/subcategories/"+r+"/recipes/"+i]=a,s["/users/"+o+"/recipes/"+i]=a,fb.database().ref().update(s).then(function(e){var r=_extends(a,{id:i});t({type:"RECIPE_SAVED",recipe:r})})}}function v(e){return function(r){if(!e)return void console.error("No newIcon passed");if(!e.name||!e.icon)return void console.error("No newIcon passed");var o=fb.database().ref().child("icons").push().key,t={};t["/icons/"+o]=e,fb.database().ref().update(t).then(function(e){})}}function p(e){return function(r){if(!e)return void console.error("No name passed");var o={name:e},t=fb.database().ref().child("categories").push().key,a={};return a["/categories/"+t]=o,fb.database().ref().update(a)}}function g(e){return function(r){return e?void fb.database().ref("categories").child(e).remove():void console.error("No id passed")}}function b(e){return function(r){return e?void fb.database().ref("icons").child(e).remove():void console.error("No id passed")}}function l(e,r){return function(o){return e?r?(fb.database().ref("subcategories").child(e).remove(),void fb.database().ref("/categories/"+r+"/subcategories").child(e).remove()):void console.error("No categoryId passed"):void console.error("No id passed")}}function E(e,r){return function(o){return e?r?(fb.database().ref("recipes").child(e).remove(),void fb.database().ref("/subcategories/"+r+"/recipes").child(e).remove()):void console.error("No subcategoryId passed"):void console.error("No id passed")}}function y(e){return function(r){function o(e){if(e.exists()){var t=e.val();console.log(t),t.error||(e.ref.off("value",o),e.ref.remove(),r({type:"RECEIVE_SEARCH_RESULTS",results:t}))}}r({type:"SET_SEARCH_QUERY",query:e}),e="*"+e+"*";var t=fb.database().ref().child("search"),a=t.child("request").push({index:"firebase",type:"recipe",query:e}).key;console.log(a),t.child("response/"+a).on("value",o)}}var h={getCategory:[],getFavorite:[],getSubcategory:[],getRecipe:[]},I={exists:function(e){return localStorage[e]},get:function(e){try{return JSON.parse(localStorage[e])}catch(e){console.warn("Couldn't parse key")}},set:function(e,r){localStorage[e]=JSON.stringify(r)}};window.__actions__={getCategories:e,getIcons:r,getCategory:o,getSubcategory:i,getRecipe:s,addCategory:p,addSubcategory:n,addRecipe:f,addIcon:v,removeIcon:b,removeCategory:g,removeSubcategory:l,removeRecipe:E,addFavorite:d,getFavorite:t,getFavorites:a,removeFavorite:u,updateRecipe:c,runSearch:y}}();