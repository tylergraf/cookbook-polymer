<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="/components/app-route/app-route.html">

<!--
`recipe-form-page`


@demo demo/index.html
-->

<dom-module id="recipe-form-page">
  <template>
    <style>
      :host {
        display: flex;
        flex-flow: column;
        align-items: center;
      }
      label {
        display: block;
        margin-top: 10px;
      }
      input {
        height: 36px;
        font-size: 30px;
        line-height: 30px;
        font-family: 'Scope One', sans-serif;
        width: 100%;
      }
      iron-autogrow-textarea {
        background: #fff;
        line-height: 1.4rem;
        font-size: 18px;
        line-height: 1.2em;
        font-family: 'Scope One', sans-serif;
        border: none;
        width: 100%;
      }
      paper-button {
        background: green;
        color: #fff;
      }
      paper-item {
        cursor: pointer;
      }
      .colors {
        display: flex;
        flex-flow: wrap;
        justify-content: space-between;
      }
      .color-wrapper {
        border: 1px solid transparent;

      }
      .color {
        height: 50px;
        width: 50px;
        margin: 4px;
      }
      .color-wrapper.iron-selected {
        border-color:#333;
      }
      .white {
        background-color: var(--white-color);
      }
      .blue {
        background-color: var(--blue-color);
      }
      .red {
        background-color: var(--red-color);
      }
      .yellow {
        background-color: var(--yellow-color);
      }
      .green {
        background-color: var(--green-color);
      }
      .purple {
        background-color: var(--purple-color);
      }
      .orange {
        background-color: var(--orange-color);
      }
      .icon {
        height: 50px;
        width: 50px;
        background: transparent no-repeat 0 0;
        background-size: contain;
        margin: 4px;
      }
      .icons {
        display: flex;
        flex-flow: wrap;
        max-height: 300px;
        overflow: scroll;
      }
      .icon-wrapper-plus.iron-selected .icon-wrapper {
        border: 1px solid #333;
      }
      .icon-wrapper-plus {
        display: flex;
        flex-flow: column;
        align-items: center;
        padding: 10px;
        width: 28%;
      }
      .icon-wrapper-plus p {
        margin-top: 6px;
        margin-bottom: 0;
      }
      .icon-wrapper {
        display: flex;
        flex-flow: column;
        align-items: center;
        justify-content: center;
        height: 80px;
        width: 80px;
        background: #fff;
        border: 1px solid #fff;

      }
      .fix-it {
        position: fixed;
        right: 10px;
        top: 80px;
        z-index: 1;
        width: 300px;
      }
      .icon-selector {
        max-width: 400px;
        width: 100%;
      }
      .form {
        width: 600px;
      }
    </style>
    <app-route
      route="{{route}}"
      pattern="/:action/:recipeId"
      data="{{routeData}}"
      ></app-route>
    <h1>New Recipe</h1>
    <form id="newRecipeForm" class="form" on-submit="_addRecipe">
      <div>
        <label for="title">Title</label>
        <input id="title" value="{{title::input}}" type="text" autofocus>
      </div>
      <div>
        <label for="description">Description</label>
        <iron-autogrow-textarea rows="2" id="description" bind-value="{{description}}"></iron-autogrow-textarea>
      </div>
      <div>
        <label for="ingredients">Ingredients (each ingredient on a new line)</label>
        <iron-autogrow-textarea rows="2" id="ingredients" bind-value="{{ingredients}}"></iron-autogrow-textarea>
      </div>
      <div>
        <label for="directions">Directions (each step on a new line)</label>
        <iron-autogrow-textarea rows="2" id="directions" bind-value="{{directions}}"></iron-autogrow-textarea>
      </div>
      <div>
        <label for="image">Image</label>
        <paper-radio-group selected="icon" id="imageType">
          <paper-radio-button name="icon" value="icon">Icon</paper-radio-button>
          <paper-radio-button name="image" value="image">Image</paper-radio-button>
        </paper-radio-group>
        <section hidden$="[[!_showImageUploader(imageType)]]">
          <polymer-dropzone id="upload" user="[[user]]" path="images/[[user.uid]]"></polymer-dropzone>
          <input id="image" is="iron-input" bind-value="{{imageUrl}}" type="text">
        </section>

        <section hidden$="[[_showImageUploader(imageType)]]" class="icon-selector">
          <iron-selector id="colors" selected="0" class="colors">
            <template is="dom-repeat" items="[[colors]]" as="color">
              <div class="color-wrapper" color$="[[color]]">
                <div class$="color [[color]]"></div>
              </div>
            </template>
          </iron-selector>

          <div>
            <input type="text" name="name" value="{{iconFilterVal::input}}" placeholder="Filter Icons">
            <iron-selector id="icons" selected="0" class="icons">
                <template is="dom-repeat" items="[[icons]]" as="icon" id="iconRepeat" filter="[[_filterIcons(iconFilterVal)]]">
                  <div class="icon-wrapper-plus" icon$="[[icon.icon]]">
                    <div class="icon-wrapper">
                      <iron-icon class="icon" icon="[[icon.icon]]"></iron-icon>
                    </div>
                    <p>[[icon.name]]</p>
                  </div>
                </template>

            </iron-selector>
          </div>
        </section>

      </div>
      <div>
        <paper-dropdown-menu label="Category" disabled$="[[!categories.length]]" vertical-align="bottom" horizontal-align="left" on-iron-select="_categorySelected">
          <paper-listbox class="dropdown-content">
            <template is="dom-repeat" items="[[categories]]" as="category">
              <paper-item value="[[category.id]]">[[category.name]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>

      <div>
        <paper-dropdown-menu id="subcategoryDD" label="Subcategory" disabled$="[[!subcategories.length]]" vertical-align="bottom" horizontal-align="left" on-iron-select="_subcategorySelected">
          <paper-listbox id="subcategoryList" class="dropdown-content">
            <template is="dom-repeat" items="[[subcategories]]" as="subcategory">
              <paper-item value="[[subcategory.id]]">[[subcategory.name]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>

      <paper-button on-tap="_addRecipe">Save</paper-button>
    </form>
  </template>

  <script>
    Polymer({
      is: 'recipe-form-page',
      ready: function(){

      },
      behaviors: [__state__],
      properties: {
        recipeId: {
          type: String,
          observer: '_recipeIdObserver'
        },
        recipeObj: {
          type: Object,
          statePath: function(state) {
            return state.recipeObjs[this.recipeId]
          },
          observer: '_recipeObjObserver'
        }
      },
      observers: ['_routeChange(routeData)'],
      _recipeIdObserver: function(recipeId){
        if(!recipeId) return;

        if(recipeId !== 'add'){
          this.dispatch(__actions__.getRecipe(recipeId));
        }
      },
      _recipeObjObserver: function(recipeObj){
        if(!recipeObj) return;
        this.set('title', recipeObj.title);
        this.set('description', recipeObj.description);
        if(recipeObj.ingredients && recipeObj.ingredients.length){
          this.set('ingredients', recipeObj.ingredients.join('\n'));
        }
        if(recipeObj.directions && recipeObj.directions.length){
          this.set('directions', recipeObj.directions.join('\n'));
        }
        this.set('icon', recipeObj.icon);
      },
      _routeChange: function(routeData){
        if(!routeData) return;
        this.set('action', routeData.action);
        this.set('recipeId', routeData.recipeId);
      }
    });
  </script>
</dom-module>
