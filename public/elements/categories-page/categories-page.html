<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/iron-list/iron-list.html">
<link rel="import" href="/elements/category-service/category-service.html">
<link rel="import" href="/elements/firebase-setup/firebase-setup.html">
<link rel="import" href="/components/polymerfire/firebase-document.html">
<link rel="import" href="/components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="/components/iron-input/iron-input.html">

<!--
`categories-page`


@demo demo/index.html
-->

<dom-module id="categories-page">
  <template>
    <!-- <firebase-setup></firebase-setup>
    <firebase-document
      id="document"
      path="/categories"
      data="{{categoriesData}}">
    </firebase-document> -->
    <app-indexeddb-mirror
      key="categories"
      data="{{categoriesData}}"
      persisted-data="{{persistedData}}">
    </app-indexeddb-mirror>
    <style>
      :host {
        display: block;
        /*flex-flow: column;
        align-items: center;*/
      }
      iron-list {
        min-height: 90vh; /* don't use % values unless the parent element is sized. */
      }
    </style>
    <div>
      <h1>Categories</h1>
      <iron-list items="[[categories]]" as="category">
        <template>
          <a href$="/category/[[category.id]]">[[category.name]]</a>
        </template>
      </iron-list>
      <!-- <form id="newCategoryForm" on-submit="_addNewCategory">
        <div>
          <input is="iron-input" bind-value="{{newCategory}}" type="text">
        </div>
        <button type="submit">Save</button>
      </form> -->
    </div>
  </template>

  <script>
    Polymer({
      is: 'categories-page',
      behaviors: [__state__],
      properties: {
        categories: {
          type: Array,
          statePath: 'categories'
        }
      },
      ready: function(){
        this.dispatch(__actions__.getCategories());
      },
      _deleteCategory: function(e, detail){
        e.preventDefault();
        var id = e.model.__data__.category.id
        this.dispatch(__actions__.removeCategory(id));

        return false;
      },
      _addNewCategory: function(e){
        e.preventDefault();
        this.dispatch(__actions__.addCategory(this.newCategory));
        this.newCategory = '';

        return false;
      },
      _categoriesObserver: function(data){
        this.set('categories', data);
      }
    });
  </script>
</dom-module>
