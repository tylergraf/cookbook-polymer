<link rel="import" href="/components/polymer/polymer-element.html">
<link rel="import" href="/components/paper-card/paper-card.html">
<link rel="import" href="/components/paper-button/paper-button.html">
<link rel="import" href="/elements/favorite-recipe/favorite-recipe.html">
<link rel="inert" href="/elements/cookbook-icons/cookbook-icons.html" async>
<link rel="import" href="/components/iron-icon/iron-icon.html">
<link rel="import" href="/components/paper-checkbox/paper-checkbox.html">

<!--
`recipe-card`


@demo demo/index.html
-->

<dom-module id="recipe-card">
  <template>
    <style is="custom-style">
      :host {
        display: block;
        font-family: 'Scope One', serif;
      }
      .card-header {
        padding: 0;
        margin: 0;
      }
      .card-heading {
        margin: 0;
        line-height: 1em;
      }
      .icon .card-heading {
        margin: 0;
        margin-top: 15px;
      }
      p {
        margin: 5px 0;
      }
      .edit {
        position: absolute;
        top: 0;
        right: 0;
      }
      paper-button {
        background-color: #fff;
        color: #333;
      }
      paper-card {
        font-family: 'Scope One', serif;
        margin: 0;
        width: 100%;
        color: #333;
      }

      paper-card.icon {
        --paper-card-header: {
          display: none;
        };
      }

      paper-card {
        --paper-card-header: {
          height: 140px;
          overflow: hidden;
          display: block;
        };
        --paper-card-header-image: {
          position: relative;
          top: -50%;
        };
      }
      paper-card .header-icon {
        height: 140px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: -16px -16px 0 -16px;
      }
      paper-card.blue .header-icon {
        background-color: var(--blue-color);
      }
      paper-card.red .header-icon {
        background-color: var(--red-color);
      }
      paper-card.yellow .header-icon {
        background-color: var(--yellow-color);
      }
      paper-card.green .header-icon {
        background-color: var(--green-color);
      }
      paper-card.purple .header-icon {
        background-color: var(--purple-color);
      }
      paper-card.orange .header-icon {
        background-color: var(--orange-color);
      }
      .header-icon iron-icon {
        height: 80px;
        width: 80px;
      }
      paper-card {
        --paper-card-content {
          padding: 0;
        };
      }
    </style>
    <paper-card id="card" image="[[imageUrl]]" class$="[[_cardIconColorClass(icon, color)]]">
      <div class="card-content">
        <a href="[[_getEditLink(id)]]" class="edit" hidden$="[[!editable]]"><paper-button>Edit</paper-button></a>
        <header class="card-header">
          <dom-if if="[[_hasImage(imageUrl)]]">
            <div class="header-icon">
              <iron-icon icon="[[icon.icon]]"></iron-icon>
            </div>
          </dom-if>
          <h2 class="card-heading">[[title]]</h2>
        </header>
        <p>[[description]]</p>
        <div><favorite-recipe favorites="[[favorites]]" recipe-id="[[id]]" subcategory-id="[[subcategoryId]]"></favorite-recipe> [[favorites.length]]</div>
        <section hidden$="[[!ingredients.length]]">
          <h3>Ingredients</h3>
          <ul>
            <template is="dom-repeat" items="[[ingredients]]" as="ingredient">
              <li><paper-checkbox></paper-checkbox>[[ingredient]]</li>
            </template>
          </ul>
        </section>
        <section hidden$="[[!directions.length]]">
          <h3>Directions</h3>
          <ol>
            <template is="dom-repeat" items="[[directions]]" as="direction">
              <li><paper-checkbox></paper-checkbox>[[direction]]</li>
            </template>
          </ol>
        </section>
      </div>
      <!-- <div class="card-actions">

      </div> -->
    </paper-card>
  </template>

  <script>

    class RecipeCard extends ReduxMixin(Polymer.Element) {
      static get is() { return "recipe-card"; }

      static get properties() {
        return {
          recipeId: {
            type: String,
            observer: '_recipeIdObserver'
          },
          recipe: {
            type: String,
            statePath({main}) {
              return main.recipeObjs[this.recipeId]
            },
            observer: '_recipeObserver'
          },
          title: {
            type: String
          },
          favorites: {
            type: Number
          },
          icon: {
            type: Object,
            value: {},
            observer: '_saveIcon'
          },
          ingredients: {
            type: Array,
            value: []
          },
          directions: {
            type: Array,
            value: []
          },
          id: {
            type: String
          },
          description: {
            type: String
          },
          imageUrl: {
            type: String,
            value: ''
          },
          color: {
            type: String,
            value: 'white',
            observer: '_saveColor'
          },
          userId: {
            type: String,
            statePath: 'main.user.uid'
          },
          editable: {
            type: Boolean,
            value: false
          },
        }
      }
      _getEditLink(id) {
        return `/recipe/edit/${id}`
      }
      _saveColor(color, oldColor) {
        // if(oldColor && color && oldColor !== color){
        //   console.log(oldColor);
        //   console.log(color);
        //   this.dispatch(__actions__.updateRecipe(this.id, {color}, this.userId));
        // }
      }
      _saveIcon(icon, oldIcon) {
        // if(oldIcon && icon && oldIcon.icon !== icon.icon){
        //   console.log(oldIcon.name);
        //   console.log(icon.name);
        //   this.dispatch(__actions__.updateRecipe(this.id, {icon}, this.userId));
        // }
      }
      _recipeIdObserver(recipeId) {
        this.dispatch(__actions__.getRecipe(recipeId));
      }
      _hasImage(imageUrl){
        return !(imageUrl);
      }
      _cardImageClass(imageUrl){
        return (imageUrl);
      }
      _cardIconColorClass(icon, color){
        return (icon) ? `icon ${color}`: color;
      }
      _imageUrlObserver(imageUrl){
        console.log(imageUrl);
      }
      _recipeImage(recipe){

        if(!this.recipe) return;
        if(this.recipe.icon){
          return this.recipe.imageUrl || this.recipe.icon.imageUrl;
        }
        return this.recipe.imageUrl;
      }
      _recipeObserver(recipe){
        if(recipe){
          this.set('title', recipe.title);
          this.set('description', recipe.description);
          this.set('icon', recipe.icon);
          this.set('color', recipe.color);
          this.set('imageUrl', recipe.imageUrl);
          this.set('favorites', recipe.favorites);
        }
      }
    }

    // Define your Element
    customElements.define(RecipeCard.is, RecipeCard);
  </script>
</dom-module>
