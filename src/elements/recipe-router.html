<link rel="import" href="/components/polymer/polymer-element.html">
<link rel="import" href="/components/app-route/app-route.html">
<link rel="import" href="/components/iron-pages/iron-pages.html">

<!--
`recipe-router`


@demo demo/index.html
-->

<dom-module id="recipe-router">
  <template>
    <app-route
      route="{{route}}"
      pattern="/:recipeId"
      data="{{routeData}}"
      ></app-route>

      <iron-pages
          selected="[[page]]"
          attr-for-selected="name"
          fallback-selection="recipe">

        <recipe-page name="recipe" recipe-id="[[routeData.recipeId]]"></recipe-page>
        <recipe-form-page name="form" route="[[route]]"></recipe-form-page>
      </iron-pages>

  </template>

  <script>

    class RecipeRouter extends ReduxMixin(Polymer.Element) {
      static get is() { return "recipe-router"; }
      static get properties() {
        return {
          route: Object,
          page: String
        }
      }
      static get observers(){
        return ['_viewChanged(routeData.recipeId)','_pageChanged(page)']
      }
      _viewChanged(recipeId){
        if(!recipeId) return;
        var component;

        if(recipeId === 'add' || recipeId === 'edit') {
          this.page = 'form';
          component = 'recipe-form-page';
        } else {
          this.page = 'recipe';
          component = 'recipe-page';
        }
        var resolvedPageUrl = this.resolveUrl( `${component}.html`);
        Polymer.importHref(resolvedPageUrl, null, null, true);
      }
    }

    // Define your Element
    customElements.define(RecipeRouter.is, RecipeRouter);
  </script>
</dom-module>
