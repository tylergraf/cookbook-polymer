<link rel="import" href="/components/polymer/polymer-element.html">
<link rel="import" href="/elements/app-state/app-state.html">
<link rel="import" href="/elements/recipe-card/recipe-card.html">
<link rel="import" href="/elements/taxonomy-path/taxonomy-path.html">
<link rel="import" href="/components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/components/app-route/app-route.html">
<!--
`recipe-page`


@demo demo/index.html
-->

<dom-module id="recipe-page">
  <template>
    <style>
      :host {
        display: block;
      }
      .recipe-card-wrapper {
        display: flex;
        flex-flow: row;
        justify-content: center;
      }
      recipe-card {
        max-width: 600px;
        width: 100%;
      }
      paper-header-panel {
        height: 90vh;
      }
    </style>
    <paper-header-panel>
      <paper-toolbar><taxonomy-path slot="top" subcategory-id="[[recipeObj.subcategoryId]]" show="category,subcategory"></taxonomy-path></paper-toolbar>

      <div class$="[[_computeWrapperClass(recipeObj)]]">
        <recipe-card
          title="[[recipeObj.title]]"
          id="[[recipeObj.id]]"
          subcategory-id="[[recipeObj.subcategoryId]]"
          favorites="[[recipeObj.favorites]]"
          description="[[recipeObj.description]]"
          color="[[recipeObj.color]]"
          ingredients="[[recipeObj.ingredients]]"
          directions="[[recipeObj.directions]]"
          image-url="[[recipeObj.imageUrl]]"
          editable="[[_isEditable(admin)]]"
          icon="[[recipeObj.icon]]"></recipe-card>
      </div>
    </paper-header-panel>

  </template>

  <script>

    class RecipePage extends ReduxMixin(Polymer.Element) {
      static get is() { return "recipe-page"; }


      static get properties() {
        return {
          recipeId: {
            type: String,
            observer: '_recipeIdObserver'
          },
          recipeObj: {
            type: Object,
            statePath({main}) {
              return main.recipeObjs[this.recipeId]
            }
          },
          userId: {
            type: Object,
            statePath: 'main.user.uid'
          },
          admin: {
            type: Boolean,
            statePath: 'main.user.admin'
          }
        }
      }

      static get observers(){
        return ['_viewChanged(routeData.recipeId)']
      }
      _recipeIdObserver(recipeId){
        if(!recipeId) return;
        if(recipeId !== 'edit' && recipeId !== 'add'){
          this.dispatch(__actions__.getRecipe(recipeId));
        }
      }
      _isEditable(admin){
        return (admin);
      }
      _computeWrapperClass(recipeObj){
        if(!recipeObj) return '';

        if(recipeObj.imageUrl){
          return 'recipe-card-wrapper image';
        }
        return `recipe-card-wrapper ${recipeObj.color}`;
      }
    }

    // Define your Element
    customElements.define(RecipePage.is, RecipePage);
  </script>
</dom-module>
