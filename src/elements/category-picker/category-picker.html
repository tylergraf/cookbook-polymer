<link rel="import" href="/components/polymer/polymer-element.html">
<link rel="import" href="/components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/components/paper-listbox/paper-listbox.html">
<link rel="import" href="/components/paper-item/paper-item.html">

<!--
`category-picker`


@demo demo/index.html
-->

<dom-module id="category-picker">
  <template>
    <style>
      :host {
        display: block;
      }

    </style>

      <paper-dropdown-menu label="Category" disabled$="[[!categories.length]]" vertical-align="bottom" horizontal-align="left" on-iron-select="_categorySelected">
        <paper-listbox id="categoryList" fallback-selection="0" selected="[[categoryId]]" attr-for-selected="id" class="dropdown-content">
          <template id="categoryRepeat" is="dom-repeat" items="[[categories]]" as="category">
            <paper-item id="[[category.id]]">[[category.name]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>

      <paper-dropdown-menu id="subcategoryDD" label="Subcategory" disabled$="[[!subcategories.length]]" vertical-align="bottom" horizontal-align="left" on-iron-select="_subcategorySelected">
        <paper-listbox id="subcategoryList" selected="[[subcategoryId]]" fallback-selection="1" attr-for-selected="id" class="dropdown-content">
          <template id="subcategoryRepeat" is="dom-repeat" items="[[subcategories]]" as="subcategory">
            <paper-item id="[[subcategory.id]]">[[subcategory.name]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
  </template>

  <script>
    
      class category-picker extends ReduxMixin(Polymer.Element) {
      static get is() { return "category-picker"; }
      
      static get properties() {
return {
        categoryId: {
          type: String,
          statePath: 'main.categoryId',
          observer: '_categoryIdObserver'
        },
        subcategoryId: {
          type: String,
          observer: '_subcategoryIdObserver',
          statePath: 'main.subcategoryId'
        },
        subcategory: {
          type: Object,
          statePath: 'main.subcategory',
          observer: '_subcategoryObserver'
        },
        category: {
          type: Object,
          statePath: 'main.category'
        },
        subcategories: {
          type: Array,
          statePath: 'main.subcategories',
          observer: '_subcategoriesObserver',
        },
        categories: {
          type: Array,
          statePath: 'main.categories'
        }
      },
      connectedCallback(){
        this.dispatch(__actions__.getCategories());
      },
      _categoryIdObserver(categoryId, oldCategoryId){
        if(!categoryId) return;

        this.dispatch(__actions__.getCategory(categoryId));


      },
      _subcategoryObserver(subcategory){
        if(!subcategory) return;

        this.dispatch(__actions__.getCategory(subcategory.categoryId));
        this.dispatch({type: 'SET_CATEGORY', categoryId: subcategory.categoryId});

      },
      _categorySelected(e){
        var category = this.$.categoryRepeat.itemForElement(e.detail.item);

        let action = {
          type: 'SET_CATEGORY',
          categoryId: category && category.id
        };

        this.dispatch(action);
      },
      _subcategorySelected(e){
        var subcategory = this.$.subcategoryRepeat.itemForElement(e.detail.item);

        let action = {
          type: 'SET_SUBCATEGORY',
          subcategoryId: subcategory && subcategory.id
        };

        this.dispatch(action);
      },
      _subcategoriesObserver(){
        if(this.subcategoryId){
          setTimeout(()=>{

          this.$.subcategoryList.select(this.subcategoryId);
        })
        }
      },
      _subcategoryIdObserver(subcategoryId, oldSubcategoryId){
        if(!oldSubcategoryId && subcategoryId){
          this.dispatch(__actions__.getSubcategory(subcategoryId));
        }


      },
    });
  }

// Define your Element
customElements.define(MyElement.is, MyElement);
</script>
</dom-module>
