<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/elements/search-bar/search-bar.html">
<link rel="import" href="/components/iron-icons/iron-icons.html">
<link rel="import" href="/components/iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="/components/paper-icon-button/paper-icon-button.html">


<!--
`taxonomy-path`


@demo demo/index.html
-->

<dom-module id="taxonomy-path">
  <template>
    <style>
      :host {
        display: flex;
        flex-flow:row;
        justify-content: space-between;
        width: 100%;
      }
      div {
        display: flex;
        flex-flow:row;
        overflow: hidden;
      }
      h2 {
        font-size: 20px;
        line-height: 40px;
        margin: 0;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      a {
        color: var(--white-color);
        margin-right: 10px;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      [hidden] {
        display: none;
      }
      @media (max-width: 550px) {
        h2 {
          font-size: 18px;
        }
      }
      search-bar {
        align-self: flex-end;
      }
      paper-icon-button {
        flex-shrink: 0;
      }
      /*@media (max-width: 760px) {
        paper-icon-button[hidden],
        paper-icon-button {
          display: block;
        }
        search-bar[hidden]
        search-bar {
          display: none;
        }
      }*/

    </style>
    <div hidden$="[[searchBarOpen]]">
      <h2><a href="/">Categories</a></h2>
      <h2 hidden$="[[_show(show, 'category')]]"><a href="/category/[[category.id]]">[[category.name]]</a></h2>
      <h2 hidden$="[[_show(show, 'subcategory')]]"><a href="/subcategory/[[subcategory.id]]">[[subcategory.name]]</a></h2>
    </div>
    <paper-icon-button icon="search" hidden$="[[searchBarOpen]]" on-tap="_openSearch"></paper-icon-button>
    <search-bar id="searchBar" hidden$="[[!searchBarOpen]]"></search-bar>

  </template>

  <script>
    Polymer({
      is: 'taxonomy-path',
      behaviors: [__state__],
      properties: {
        categoryId: {
          type: String,
          observer: '_categoryIdObserver'
        },
        category: {
          type: Object,
          statePath: 'main.category'
        },
        subcategoryId: {
          type: String,
          observer: '_subcategoryIdObserver'
        },
        subcategory: {
          type: Object,
          statePath: 'main.subcategory',
          observer: '_subcategoryObserver'
        },
        show: {
          type: String,
          value: ''
        },
        searchBarOpen: {
          type: Boolean,
          statePath: 'main.searchBarOpen'
        }
      },
      _show: function(show, item){
        if(show){
          var showing = show.split(',');
          if(showing.includes(item)){
            return false;
          }
        }
        return true;
      },
      _categoryIdObserver: function(id){
        if(id){
          this.dispatch(__actions__.getCategory(id));
        }
      },
      _subcategoryIdObserver: function(id){
        if(id){
          this.dispatch(__actions__.getSubcategory(id));
        }
      },
      _subcategoryObserver: function(subcategory){
        if(subcategory && subcategory.name && !(this.category && this.category.name)){
          this.dispatch(__actions__.getCategory(subcategory.categoryId));
        }
      },
      _openSearch: function(e) {
        e.preventDefault();
        this.dispatch({type: 'SET_SEARCH_BAR_OPEN', showing: true});
        this.$.searchBar.fire('focus-search');
      },
    });
  </script>
</dom-module>
